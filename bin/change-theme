#!/bin/bash

## @file
# Changes the dwm theme.
#
# $1 - name of the theme.
#
# @author Anh Dinh Trong <ad438310@students.mimuw.edu.pl>
# @date 2022
#

REPO="$HOME/Build/dwm"
BASHRC="$REPO/bin/bashrc"
FEHBG="$REPO/bin/fehbg"
INCLUDE="$REPO/include"
PATCHES="$REPO/patch"

HOSTNAME_COLOR="1;36m"
FORMAT="jpg"
WORKING_DIR='extract'
THEMES=(alicia beatrice maria)

theme="$1"
reg1="^[[:alnum:]]+$" # Check if theme is available.
reg2="\b$theme\b"
if [[ ! $theme =~ $reg1 || ! ${THEMES[@]} =~ $reg2 ]]; then
  echo "There's no such theme."
  exit 1
fi

cd "$REPO"
mkdir "$WORKING_DIR"
tar -xzf "$PATCHES/$theme.tar.gz" -C "$WORKING_DIR"

source "$WORKING_DIR/header" # Load variables.

echo "Changing the hostname color..." # Assuming white is not a color.
rep="\\\[\\033\[$HOSTNAME_COLOR\]"
sed -n '/PS1/s/\\\[\\033\[[01];3[0-68-9]m\\\]/'"$rep"'/g p' "$BASHRC"
echo "Done!"; sleep 1s

echo "Changing the background..."
sed -n '/feh/s/preview\/.*\.jpg/preview\/'"$theme\.$FORMAT"'/g p' "$FEHBG"
echo "Done!"; sleep 1s

echo "Changing dwm's colorscheme..."
echo "$WORKING_DIR/palette.h" "$INCLUDE"
echo "Done!"; sleep 1s

echo "Cleaning up..."
rm -r extract
echo "Done!"; sleep 1s
# 
# echo "Please restart the X session for the changes to be finalized."
# # sudo make clean install
